{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory 이름",
			"defaultValue": "CDI-Hub-ADF-p01"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MAS_SHOPPING_DELYVERY_DETAIL_SUB_ALL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "ForEach Copy data",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "page",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(1  \n      ,add(\n             div(\n                  int(activity('page').output.firstRow.response.body.totalCount) \n                 ,int(pipeline().parameters.one_page_row)                  \n                )\n            ,if(\n                greater(\n                        mod(\n                             int(activity('page').output.firstRow.response.body.totalCount) \n                        ,int(pipeline().parameters.one_page_row)   \n                            )\n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 40,
							"activities": [
								{
									"name": "Copy data1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 5,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "AzurePostgreSQLSink",
											"writeBatchSize": 1000000,
											"writeBatchTimeout": "00:30:00",
											"writeMethod": "CopyCommand"
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['dlvrReqNo']"
													},
													"sink": {
														"name": "dlvr_req_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqChgOrd']"
													},
													"sink": {
														"name": "dlvr_req_chg_ord",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqRcptDate']"
													},
													"sink": {
														"name": "dlvr_req_rcpt_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctSno']"
													},
													"sink": {
														"name": "prdct_sno"
													}
												},
												{
													"source": {
														"path": "[['prdctClsfcNo']"
													},
													"sink": {
														"name": "prdct_clsfc_no"
													}
												},
												{
													"source": {
														"path": "[['prdctClsfcNoNm']"
													},
													"sink": {
														"name": "prdct_clsfc_no_nm"
													}
												},
												{
													"source": {
														"path": "[['dtilPrdctClsfcNo']"
													},
													"sink": {
														"name": "dtil_prdct_clsfc_no"
													}
												},
												{
													"source": {
														"path": "[['dtilPrdctClsfcNoNm']"
													},
													"sink": {
														"name": "dtil_prdct_clsfc_no_nm"
													}
												},
												{
													"source": {
														"path": "[['prdctIdntNo']"
													},
													"sink": {
														"name": "prdct_idnt_no"
													}
												},
												{
													"source": {
														"path": "[['prdctIdntNoNm']"
													},
													"sink": {
														"name": "prdct_idnt_no_nm"
													}
												},
												{
													"source": {
														"path": "[['prdctUprc']"
													},
													"sink": {
														"name": "prdct_uprc"
													}
												},
												{
													"source": {
														"path": "[['prdctUnit']"
													},
													"sink": {
														"name": "prdct_unit"
													}
												},
												{
													"source": {
														"path": "[['prdctQty']"
													},
													"sink": {
														"name": "prdct_qty"
													}
												},
												{
													"source": {
														"path": "[['prdctAmt']"
													},
													"sink": {
														"name": "prdct_amt"
													}
												},
												{
													"source": {
														"path": "[['dlvrTmlmtDate']"
													},
													"sink": {
														"name": "dlvr_tmlmt_date"
													}
												},
												{
													"source": {
														"path": "[['cntrctCnclsStleNm']"
													},
													"sink": {
														"name": "cntrct_cncls_stle_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['exclcProdctYn']"
													},
													"sink": {
														"name": "exclc_prodct_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['optnDivCdNm']"
													},
													"sink": {
														"name": "optn_div_cd_nm"
													}
												},
												{
													"source": {
														"path": "[['dminsttCd']"
													},
													"sink": {
														"name": "dminstt_cd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttNm']"
													},
													"sink": {
														"name": "dminstt_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dmndInsttDivNm']"
													},
													"sink": {
														"name": "dmnd_instt_div_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttRgnNm']"
													},
													"sink": {
														"name": "dminstt_rgn_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['corpNm']"
													},
													"sink": {
														"name": "corp_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['fnlDlvrReqYn']"
													},
													"sink": {
														"name": "fnl_dlvr_req_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['incdecQty']"
													},
													"sink": {
														"name": "incdec_qty"
													}
												},
												{
													"source": {
														"path": "[['incdecAmt']"
													},
													"sink": {
														"name": "incdec_amt"
													}
												},
												{
													"source": {
														"path": "[['cntrctCorpBizno']"
													},
													"sink": {
														"name": "cntrct_corp_bizno"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqNm']"
													},
													"sink": {
														"name": "dlvr_req_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctNo']"
													},
													"sink": {
														"name": "cntrct_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctChgOrd']"
													},
													"sink": {
														"name": "cntrct_chg_ord",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['masYn']"
													},
													"sink": {
														"name": "mas_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cnstwkMtrlDrctPurchsObjYn']"
													},
													"sink": {
														"name": "cnstwk_mtrl_drct_purchs_obj_yn"
													}
												},
												{
													"source": {
														"path": "[['IntlCntrctDlvrReqDate']"
													},
													"sink": {
														"name": "intl_cntrct_dlvr_req_date"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqQty']"
													},
													"sink": {
														"name": "dlvr_req_qty",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqAmt']"
													},
													"sink": {
														"name": "dlvr_req_amt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['smetprCmptProdctYn']"
													},
													"sink": {
														"name": "smetpr_cmpt_prodct_yn"
													}
												},
												{
													"source": {
														"path": "[['corpEntrprsDivNmNm']"
													},
													"sink": {
														"name": "corp_entrprs_div_nm"
													}
												},
												{
													"source": {
														"path": "[['brnofceNm']"
													},
													"sink": {
														"name": "brnofce_nm"
													}
												}
											],
											"collectionReference": "$['response']['body']['items']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_PPS_API_JSON",
											"type": "DatasetReference",
											"parameters": {
												"params": {
													"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=',item(),'&numOfRows=',pipeline().parameters.one_page_row,'&inqryBgnDate='\n,pipeline().parameters.strdt,'&inqryEndDate=',pipeline().parameters.enddt,'&dtilPrdctClsfcNoNm=',pipeline().parameters.product,'&ServiceKey=',pipeline().parameters.Apikey)",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_POSTGRESQL_SNK",
											"type": "DatasetReference",
											"parameters": {
												"SinkSchema": {
													"value": "@pipeline().parameters.SinkSchema",
													"type": "Expression"
												},
												"SinkTable": {
													"value": "@pipeline().parameters.SinkTable",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE REPLACE(dlvr_req_rcpt_date,'-','') BETWEEN '@{pipeline().parameters.strdt}' AND '@{pipeline().parameters.enddt}' \n  ;\n\nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					},
					{
						"name": "page",
						"description": "대표 제품의 생성 기간동안 토탈 건수 ",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_PPS_API_JSON",
								"type": "DatasetReference",
								"parameters": {
									"params": {
										"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=1&numOfRows=1&inqryBgnDate=',pipeline().parameters.strdt,'&inqryEndDate=',pipeline().parameters.enddt,'&ServiceKey=',pipeline().parameters.Apikey)",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "delete",
						"description": "미사용데이터 삭제\n",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE REPLACE(dlvr_req_rcpt_date,'-','') BETWEEN '@{pipeline().parameters.strdt}' AND '@{pipeline().parameters.enddt}' \n   and dtil_prdct_clsfc_no !~ '^(501|502|503|504).*'\n  ;\n\nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Apikey": {
						"type": "string",
						"defaultValue": "W26gwh49fADZe9fVLqkaAlzn5IPh6n9jf9FCHkThIs6UDblFv46xFoLaNzl011vFX8daAemoPlw4BubABfFBRg%3D%3D"
					},
					"service": {
						"type": "string",
						"defaultValue": "getDlvrReqDtlInfoList01"
					},
					"tot_row": {
						"type": "string",
						"defaultValue": "1"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_mas_shopping_delivery_detail2"
					},
					"one_page_row": {
						"type": "string",
						"defaultValue": "999"
					},
					"product": {
						"type": "string"
					},
					"strdt": {
						"type": "string",
						"defaultValue": "20230301"
					},
					"enddt": {
						"type": "string",
						"defaultValue": "20230331"
					}
				},
				"variables": {
					"TEST": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/조달청/종합쇼핑몰 납품요구정보 현황"
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MAS_SHOPPING_DELYVERY_INC')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "수요기관정보조회",
				"activities": [
					{
						"name": "set strdt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "strdt",
							"value": {
								"value": "@if(equals(pipeline().parameters.pipstrdt,null),formatDateTime(addDays(addHours(utcNow(), 9),-3),'yyyyMMdd'),pipeline().parameters.pipstrdt)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "set enddt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "enddt",
							"value": {
								"value": "@if(equals(pipeline().parameters.pipenddt,null),formatDateTime(addDays(addHours(utcNow(), 9),-1),'yyyyMMdd'),pipeline().parameters.pipenddt)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "delete table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "set strdt",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "set enddt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE  REGEXP_REPLACE(dlvr_req_rcpt_date, '[^0-9]','','g') BETWEEN '@{variables('strdt')}' AND '@{variables('enddt')}';\n \nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					},
					{
						"name": "get page",
						"description": "대표 제품의 생성 기간동안 토탈 건수 ",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "delete table",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_PPS_API_JSON",
								"type": "DatasetReference",
								"parameters": {
									"params": {
										"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=1&numOfRows=1&inqryBgnDate=',variables('strdt'),'&inqryEndDate=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "get page",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(1  \n      ,add(\n             div(\n                  int(activity('get page').output.firstRow.response.body.totalCount) \n                 ,int(pipeline().parameters.one_page_row)                  \n                )\n            ,if(\n                greater(\n                        mod(\n                            int(activity('get page').output.firstRow.response.body.totalCount) \n                        ,int(pipeline().parameters.one_page_row)   \n                            )\n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 20,
							"activities": [
								{
									"name": "Copy data1_copy1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 5,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "AzurePostgreSQLSink",
											"writeBatchSize": 1000000,
											"writeBatchTimeout": "00:30:00",
											"writeMethod": "CopyCommand"
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['dlvrReqNo']"
													},
													"sink": {
														"name": "dlvr_req_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqChgOrd']"
													},
													"sink": {
														"name": "dlvr_req_chg_ord",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqRcptDate']"
													},
													"sink": {
														"name": "dlvr_req_rcpt_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqNm']"
													},
													"sink": {
														"name": "dlvr_req_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqQty']"
													},
													"sink": {
														"name": "dlvr_req_qty",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqAmt']"
													},
													"sink": {
														"name": "dlvr_req_amt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttCd']"
													},
													"sink": {
														"name": "dminstt_cd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttNm']"
													},
													"sink": {
														"name": "dminstt_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dmndInsttDivNm']"
													},
													"sink": {
														"name": "dmnd_instt_div_nm"
													}
												},
												{
													"source": {
														"path": "[['dminsttRgnNm']"
													},
													"sink": {
														"name": "dminstt_rgn_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['corpNm']"
													},
													"sink": {
														"name": "corp_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['corpEntrprsDivNm']"
													},
													"sink": {
														"name": "corpentrprs_div_nm_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rprsntPrdctClsfcNo']"
													},
													"sink": {
														"name": "rprsnt_prdct_clsfc_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rprsntPrdctClsfcNoNm']"
													},
													"sink": {
														"name": "rprsnt_prdct_clsfc_no_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rprsntDtilPrdctClsfcNo']"
													},
													"sink": {
														"name": "rprsnt_dtil_prdct_clsfc_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rprsntDtilPrdctClsfcNoNm']"
													},
													"sink": {
														"name": "rprsnt_dtil_prdct_clsfc_no_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['maxDlvrTmlmtDate']"
													},
													"sink": {
														"name": "max_dlvr_tmlmt_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctCnclsStleNm']"
													},
													"sink": {
														"name": "cntrct_cncls_stle_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctNo']"
													},
													"sink": {
														"name": "cntrct_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctChgOrd']"
													},
													"sink": {
														"name": "cntrct_chg_ord",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['masYn']"
													},
													"sink": {
														"name": "mas_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['exclcProdctYn']"
													},
													"sink": {
														"name": "exclc_prodct_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['fnlDlvrReqYn']"
													},
													"sink": {
														"name": "fnl_dlvr_req_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqIncdecQty']"
													},
													"sink": {
														"name": "dlvr_req_incdec_qty",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrReqIncdecAmt']"
													},
													"sink": {
														"name": "dlvr_req_incdec_amt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['corpBizno']"
													},
													"sink": {
														"name": "corp_bizno",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['response']['body']['items']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_PPS_API_JSON",
											"type": "DatasetReference",
											"parameters": {
												"params": {
													"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=',item(),'&numOfRows=',pipeline().parameters.one_page_row,'&inqryBgnDate=',variables('strdt'),'&inqryEndDate=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_POSTGRESQL_SNK",
											"type": "DatasetReference",
											"parameters": {
												"SinkSchema": {
													"value": "@pipeline().parameters.SinkSchema",
													"type": "Expression"
												},
												"SinkTable": {
													"value": "@pipeline().parameters.SinkTable",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Apikey": {
						"type": "string",
						"defaultValue": "W26gwh49fADZe9fVLqkaAlzn5IPh6n9jf9FCHkThIs6UDblFv46xFoLaNzl011vFX8daAemoPlw4BubABfFBRg%3D%3D"
					},
					"service": {
						"type": "string",
						"defaultValue": "getDlvrReqInfoList01"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_mas_shopping_delivery"
					},
					"one_page_row": {
						"type": "string",
						"defaultValue": "999"
					},
					"pipstrdt": {
						"type": "string"
					},
					"pipenddt": {
						"type": "string"
					}
				},
				"variables": {
					"strdt": {
						"type": "String"
					},
					"enddt": {
						"type": "String"
					},
					"getcnt": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/조달청/종합쇼핑몰 납품요구정보 현황"
				},
				"annotations": [],
				"lastPublishTime": "2023-01-16T07:55:39Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MAS_SHOPPING_PRODUCT_INC')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "ForEach Copy data",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(1  \n      ,add(\n             div(\n                  int(activity('product cnt').output.firstRow.response.body.totalCount) \n                 ,int(pipeline().parameters.one_page_row)                  \n                )\n            ,if(\n                greater(\n                        mod(\n                             int(activity('product cnt').output.firstRow.response.body.totalCount) \n                        ,int(pipeline().parameters.one_page_row)   \n                            )\n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "Copy data1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 5,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "AzurePostgreSQLSink",
											"writeBatchSize": 1000000,
											"writeBatchTimeout": "00:30:00",
											"writeMethod": "CopyCommand"
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['prdctImgUrl']"
													},
													"sink": {
														"name": "prdct_img_url",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctCorpNm']"
													},
													"sink": {
														"name": "cntrct_corp_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['entrprsDivNm']"
													},
													"sink": {
														"name": "entrprs_div_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctMthdNm']"
													},
													"sink": {
														"name": "cntrct_mthd_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['exclncPrcrmntPrdctYn']"
													},
													"sink": {
														"name": "exclnc_prcrmnt_prdct_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['masYn']"
													},
													"sink": {
														"name": "mas_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['smetprCmptProdctYn']"
													},
													"sink": {
														"name": "smetpr_cmpt_prodct_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctPrceAmt']"
													},
													"sink": {
														"name": "cntrct_prce_amt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctUnit']"
													},
													"sink": {
														"name": "prdct_unit",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctMakrNm']"
													},
													"sink": {
														"name": "prdct_makr_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctDlvrPlceNm']"
													},
													"sink": {
														"name": "prdct_dlvr_plce_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctDlvryCndtnNm']"
													},
													"sink": {
														"name": "prdct_dlvry_cndtn_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctSplyRgnNm']"
													},
													"sink": {
														"name": "prdct_sply_rgn_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrTmlmtDaynum']"
													},
													"sink": {
														"name": "dlvr_tmlmt_daynum",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctLrgclsfcCd']"
													},
													"sink": {
														"name": "prdct_lrgclsfc_cd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctLrgclsfcNm']"
													},
													"sink": {
														"name": "prdct_lrgclsfc_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctMidclsfcCd']"
													},
													"sink": {
														"name": "prdct_midclsfc_cd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctMidclsfcNm']"
													},
													"sink": {
														"name": "prdct_midclsfc_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctClsfcNo']"
													},
													"sink": {
														"name": "prdct_clsfc_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctClsfcNoNm']"
													},
													"sink": {
														"name": "prdct_clsfc_no_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dtilPrdctClsfcNo']"
													},
													"sink": {
														"name": "dtil_prdct_clsfc_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dtilPrdctClsfcNoNm']"
													},
													"sink": {
														"name": "dtil_prdct_clsfc_no_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctIdntNo']"
													},
													"sink": {
														"name": "prdct_idnt_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctSpecNm']"
													},
													"sink": {
														"name": "prdct_spec_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['shopngCntrctNo']"
													},
													"sink": {
														"name": "shopng_cntrct_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['shopngCntrctSno']"
													},
													"sink": {
														"name": "shopng_cntrct_sno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctDate']"
													},
													"sink": {
														"name": "cntrct_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctBgnDate']"
													},
													"sink": {
														"name": "cntrct_bgn_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctEndDate']"
													},
													"sink": {
														"name": "cntrct_end_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctDeptNm']"
													},
													"sink": {
														"name": "cntrct_dept_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prodctCertList']"
													},
													"sink": {
														"name": "prodct_cert_list",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rgstDt']"
													},
													"sink": {
														"name": "rgst_dt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctCorpBizno']"
													},
													"sink": {
														"name": "cntrct_corp_bizno",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['response']['body']['items']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_PPS_API_JSON",
											"type": "DatasetReference",
											"parameters": {
												"params": {
													"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=',item(),'&numOfRows=',pipeline().parameters.one_page_row,'&inqryBgnDate='\n,variables('strdt'),'&inqryEndDate=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_POSTGRESQL_SNK",
											"type": "DatasetReference",
											"parameters": {
												"SinkSchema": {
													"value": "@pipeline().parameters.SinkSchema",
													"type": "Expression"
												},
												"SinkTable": {
													"value": "@pipeline().parameters.SinkTable",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "product cnt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE REPLACE(rgst_dt,'-','') BETWEEN '@{variables('strdt')}' AND '@{variables('enddt')}' \n  ;\n\nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					},
					{
						"name": "set strdt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "strdt",
							"value": {
								"value": "@if(equals(pipeline().parameters.strdt,null),formatDateTime(addDays(addHours(utcNow(), 9),-3),'yyyyMMdd'),pipeline().parameters.strdt)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "set enddt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "enddt",
							"value": {
								"value": "@if(equals(pipeline().parameters.enddt,null),formatDateTime(addDays(addHours(utcNow(), 9),-1),'yyyyMMdd'),pipeline().parameters.enddt)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "product cnt",
						"description": "대표 제품의 생성 기간동안 토탈 건수 ",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "set strdt",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "set enddt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_PPS_API_JSON",
								"type": "DatasetReference",
								"parameters": {
									"params": {
										"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=1&numOfRows=1&inqryBgnDate=',variables('strdt'),'&inqryEndDate=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
										"type": "Expression"
									}
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Apikey": {
						"type": "string",
						"defaultValue": "W26gwh49fADZe9fVLqkaAlzn5IPh6n9jf9FCHkThIs6UDblFv46xFoLaNzl011vFX8daAemoPlw4BubABfFBRg%3D%3D"
					},
					"service": {
						"type": "string",
						"defaultValue": "getShoppingMallPrdctInfoList01"
					},
					"tot_row": {
						"type": "string",
						"defaultValue": "1"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_mas_shopping_product"
					},
					"one_page_row": {
						"type": "string",
						"defaultValue": "999"
					},
					"product": {
						"type": "string"
					},
					"strdt": {
						"type": "string"
					},
					"enddt": {
						"type": "string"
					}
				},
				"variables": {
					"TEST": {
						"type": "String"
					},
					"strdt": {
						"type": "String"
					},
					"enddt": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/조달청/종합쇼핑몰 납품요구정보 현황"
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MAS_SHOPPING_PRODUCT_SUB_TEST')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "ForEach Copy data",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Completed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(1  \n      ,add(\n             div(\n                  int(pipeline().parameters.tot_row) \n                 ,int(pipeline().parameters.one_page_row)                  \n                )\n            ,if(\n                greater(\n                        mod(\n                             int(pipeline().parameters.tot_row) \n                        ,int(pipeline().parameters.one_page_row)   \n                            )\n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "Copy data1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "AzurePostgreSQLSink",
											"writeBatchSize": 1000000,
											"writeBatchTimeout": "00:30:00",
											"writeMethod": "CopyCommand"
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['prdctImgUrl']"
													},
													"sink": {
														"name": "prdct_img_url",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctCorpNm']"
													},
													"sink": {
														"name": "cntrct_corp_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['entrprsDivNm']"
													},
													"sink": {
														"name": "entrprs_div_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctMthdNm']"
													},
													"sink": {
														"name": "cntrct_mthd_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['exclncPrcrmntPrdctYn']"
													},
													"sink": {
														"name": "exclnc_prcrmnt_prdct_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['masYn']"
													},
													"sink": {
														"name": "mas_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['smetprCmptProdctYn']"
													},
													"sink": {
														"name": "smetpr_cmpt_prodct_yn",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctPrceAmt']"
													},
													"sink": {
														"name": "cntrct_prce_amt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctUnit']"
													},
													"sink": {
														"name": "prdct_unit",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctMakrNm']"
													},
													"sink": {
														"name": "prdct_makr_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctDlvrPlceNm']"
													},
													"sink": {
														"name": "prdct_dlvr_plce_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctDlvryCndtnNm']"
													},
													"sink": {
														"name": "prdct_dlvry_cndtn_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctSplyRgnNm']"
													},
													"sink": {
														"name": "prdct_sply_rgn_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dlvrTmlmtDaynum']"
													},
													"sink": {
														"name": "dlvr_tmlmt_daynum",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctLrgclsfcCd']"
													},
													"sink": {
														"name": "prdct_lrgclsfc_cd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctLrgclsfcNm']"
													},
													"sink": {
														"name": "prdct_lrgclsfc_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctMidclsfcCd']"
													},
													"sink": {
														"name": "prdct_midclsfc_cd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctMidclsfcNm']"
													},
													"sink": {
														"name": "prdct_midclsfc_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctClsfcNo']"
													},
													"sink": {
														"name": "prdct_clsfc_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctClsfcNoNm']"
													},
													"sink": {
														"name": "prdct_clsfc_no_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dtilPrdctClsfcNo']"
													},
													"sink": {
														"name": "dtil_prdct_clsfc_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dtilPrdctClsfcNoNm']"
													},
													"sink": {
														"name": "dtil_prdct_clsfc_no_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctIdntNo']"
													},
													"sink": {
														"name": "prdct_idnt_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prdctSpecNm']"
													},
													"sink": {
														"name": "prdct_spec_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['shopngCntrctNo']"
													},
													"sink": {
														"name": "shopng_cntrct_no",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['shopngCntrctSno']"
													},
													"sink": {
														"name": "shopng_cntrct_sno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctDate']"
													},
													"sink": {
														"name": "cntrct_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctBgnDate']"
													},
													"sink": {
														"name": "cntrct_bgn_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctEndDate']"
													},
													"sink": {
														"name": "cntrct_end_date",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctDeptNm']"
													},
													"sink": {
														"name": "cntrct_dept_nm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prodctCertList']"
													},
													"sink": {
														"name": "prodct_cert_list",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rgstDt']"
													},
													"sink": {
														"name": "rgst_dt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['cntrctCorpBizno']"
													},
													"sink": {
														"name": "cntrct_corp_bizno",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['response']['body']['items']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_PPS_API_JSON",
											"type": "DatasetReference",
											"parameters": {
												"params": {
													"value": "@concat('/1230000/ShoppingMallPrdctInfoService06/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=',item(),'&numOfRows=',pipeline().parameters.one_page_row,'&inqryBgnDate='\n,pipeline().parameters.strdt,'&inqryEndDate=',pipeline().parameters.enddt,'&dtilPrdctClsfcNoNm=',pipeline().parameters.product,'&ServiceKey=',pipeline().parameters.Apikey)",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_POSTGRESQL_SNK",
											"type": "DatasetReference",
											"parameters": {
												"SinkSchema": {
													"value": "@pipeline().parameters.SinkSchema",
													"type": "Expression"
												},
												"SinkTable": {
													"value": "@pipeline().parameters.SinkTable",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE REPLACE(rgstDt,'-','') BETWEEN '@{pipeline().parameters.strdt}' AND '@{pipeline().parameters.enddt}' \n   AND dtil_prdct_clsfc_no_nm = '@{pipeline().parameters.product}';\n\nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Apikey": {
						"type": "string",
						"defaultValue": "W26gwh49fADZe9fVLqkaAlzn5IPh6n9jf9FCHkThIs6UDblFv46xFoLaNzl011vFX8daAemoPlw4BubABfFBRg%3D%3D"
					},
					"service": {
						"type": "string",
						"defaultValue": "getShoppingMallPrdctInfoList01"
					},
					"tot_row": {
						"type": "string",
						"defaultValue": "1"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_mas_shopping_product"
					},
					"one_page_row": {
						"type": "string",
						"defaultValue": "999"
					},
					"product": {
						"type": "string"
					},
					"strdt": {
						"type": "string"
					},
					"enddt": {
						"type": "string"
					}
				},
				"variables": {
					"TEST": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/조달청/종합쇼핑몰 납품요구정보 현황"
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MAS_SUCCESSFUL_BID_LIST_STATUS_THINGS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "낙찰된 목록 현황 물품조회",
				"activities": [
					{
						"name": "set strdt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "strdt",
							"value": {
								"value": "@if(equals(pipeline().parameters.pipstrdt,null),'200201010000',pipeline().parameters.pipstrdt)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "set enddt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "enddt",
							"value": {
								"value": "@if(equals(pipeline().parameters.pipenddt,null),'200212310000',pipeline().parameters.pipenddt)",
								"type": "Expression"
							}
						}
					},
					{
						"name": "delet table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "set strdt",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "set enddt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE  REGEXP_REPLACE(rgstDt, '[^0-9]','','g') BETWEEN '@{variables('strdt')}' AND '@{variables('enddt')}';\n \nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					},
					{
						"name": "get page",
						"description": "대표 제품의 생성 기간동안 토탈 건수 ",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "delet table",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_PPS_API_JSON",
								"type": "DatasetReference",
								"parameters": {
									"params": {
										"value": "@concat('/1230000/ScsbidInfoService01/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=1&numOfRows=1&inqryBgnDt=',variables('strdt'),'&inqryEndDt=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "get page",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(1  \n      ,add(\n             div(\n                  int(activity('get page').output.firstRow.response.body.totalCount) \n                 ,int(pipeline().parameters.one_page_row)                  \n                )\n            ,if(\n                greater(\n                        mod(\n                            int(activity('get page').output.firstRow.response.body.totalCount) \n                        ,int(pipeline().parameters.one_page_row)   \n                            )\n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy data1_copy1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "AzurePostgreSQLSink",
											"writeBatchSize": 1000000,
											"writeBatchTimeout": "00:30:00",
											"writeMethod": "CopyCommand"
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['bidNtceNo']"
													},
													"sink": {
														"name": "bidntceno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidNtceOrd']"
													},
													"sink": {
														"name": "bidntceord",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidClsfcNo']"
													},
													"sink": {
														"name": "bidclsfcno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rbidNo']"
													},
													"sink": {
														"name": "rbidno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ntceDivCd']"
													},
													"sink": {
														"name": "ntcedivcd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidNtceNm']"
													},
													"sink": {
														"name": "bidntcenm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prtcptCnum']"
													},
													"sink": {
														"name": "prtcptcnum",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrNm']"
													},
													"sink": {
														"name": "bidwinnrnm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrBizno']"
													},
													"sink": {
														"name": "bidwinnrbizno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrCeoNm']"
													},
													"sink": {
														"name": "bidwinnrceonm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrAdrs']"
													},
													"sink": {
														"name": "bidwinnradrs",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrTelNo']"
													},
													"sink": {
														"name": "bidwinnrtelno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['sucsfbidAmt']"
													},
													"sink": {
														"name": "sucsfbidamt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['sucsfbidRate']"
													},
													"sink": {
														"name": "sucsfbidrate",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rlOpengDt']"
													},
													"sink": {
														"name": "rlopengdt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttCd']"
													},
													"sink": {
														"name": "dminsttcd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttNm']"
													},
													"sink": {
														"name": "dminsttnm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rgstDt']"
													},
													"sink": {
														"name": "rgstdt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['fnlSucsfDate']"
													},
													"sink": {
														"name": "fnlsucsfdate",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['fnlSucsfCorpOfcl']"
													},
													"sink": {
														"name": "fnlsucsfcorpofcl",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['linkInsttNm']"
													},
													"sink": {
														"name": "linkinsttnm",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['response']['body']['items']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_PPS_API_JSON",
											"type": "DatasetReference",
											"parameters": {
												"params": {
													"value": "@concat('/1230000/ScsbidInfoService/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=',item(),'&numOfRows=',pipeline().parameters.one_page_row,'&inqryBgnDt=',variables('strdt'),'&inqryEndDt=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_POSTGRESQL_SNK",
											"type": "DatasetReference",
											"parameters": {
												"SinkSchema": {
													"value": "@pipeline().parameters.SinkSchema",
													"type": "Expression"
												},
												"SinkTable": {
													"value": "@pipeline().parameters.SinkTable",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Apikey": {
						"type": "string",
						"defaultValue": "W26gwh49fADZe9fVLqkaAlzn5IPh6n9jf9FCHkThIs6UDblFv46xFoLaNzl011vFX8daAemoPlw4BubABfFBRg%3D%3D"
					},
					"service": {
						"type": "string",
						"defaultValue": "getScsbidListSttusThng01"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_mas_successful_bid_list_status_things"
					},
					"one_page_row": {
						"type": "string",
						"defaultValue": "999"
					},
					"pipstrdt": {
						"type": "string"
					},
					"pipenddt": {
						"type": "string"
					}
				},
				"variables": {
					"strdt": {
						"type": "String"
					},
					"enddt": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/조달청"
				},
				"annotations": [],
				"lastPublishTime": "2023-01-16T07:55:39Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MAS_SUCCESSFUL_BID_LIST_STATUS_THINGS_INC')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "낙찰된 목록 현황 물품조회",
				"activities": [
					{
						"name": "set strdt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "strdt",
							"value": {
								"value": "@concat(formatDateTime(adddays(addHours(utcNow(), 9), -7), 'yyyyMMdd'),'0000')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "set enddt",
						"description": "당일자",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "enddt",
							"value": {
								"value": "@concat(formatDateTime(adddays(addHours(utcNow(), 9), -1), 'yyyyMMdd'),'0000')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "delet table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "set strdt",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "set enddt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "delete from  @{pipeline().parameters.SinkSchema}.@{pipeline().parameters.SinkTable}       \n WHERE  REGEXP_REPLACE(rgstDt, '[^0-9]','','g') BETWEEN '@{variables('strdt')}' AND '@{variables('enddt')}';\n \nselect 1 as success",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					},
					{
						"name": "get page",
						"description": "대표 제품의 생성 기간동안 토탈 건수 ",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "delet table",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_PPS_API_JSON",
								"type": "DatasetReference",
								"parameters": {
									"params": {
										"value": "@concat('/1230000/ScsbidInfoService01/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=1&numOfRows=1&inqryBgnDt=',variables('strdt'),'&inqryEndDt=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
										"type": "Expression"
									}
								}
							}
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "get page",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(1  \n      ,add(\n             div(\n                  int(activity('get page').output.firstRow.response.body.totalCount) \n                 ,int(pipeline().parameters.one_page_row)                  \n                )\n            ,if(\n                greater(\n                        mod(\n                            int(activity('get page').output.firstRow.response.body.totalCount) \n                        ,int(pipeline().parameters.one_page_row)   \n                            )\n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy data1_copy1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "JsonSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "JsonReadSettings"
											}
										},
										"sink": {
											"type": "AzurePostgreSQLSink",
											"writeBatchSize": 1000000,
											"writeBatchTimeout": "00:30:00",
											"writeMethod": "CopyCommand"
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['bidNtceNo']"
													},
													"sink": {
														"name": "bidntceno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidNtceOrd']"
													},
													"sink": {
														"name": "bidntceord",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidClsfcNo']"
													},
													"sink": {
														"name": "bidclsfcno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rbidNo']"
													},
													"sink": {
														"name": "rbidno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ntceDivCd']"
													},
													"sink": {
														"name": "ntcedivcd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidNtceNm']"
													},
													"sink": {
														"name": "bidntcenm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['prtcptCnum']"
													},
													"sink": {
														"name": "prtcptcnum",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrNm']"
													},
													"sink": {
														"name": "bidwinnrnm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrBizno']"
													},
													"sink": {
														"name": "bidwinnrbizno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrCeoNm']"
													},
													"sink": {
														"name": "bidwinnrceonm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrAdrs']"
													},
													"sink": {
														"name": "bidwinnradrs",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['bidwinnrTelNo']"
													},
													"sink": {
														"name": "bidwinnrtelno",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['sucsfbidAmt']"
													},
													"sink": {
														"name": "sucsfbidamt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['sucsfbidRate']"
													},
													"sink": {
														"name": "sucsfbidrate",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rlOpengDt']"
													},
													"sink": {
														"name": "rlopengdt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttCd']"
													},
													"sink": {
														"name": "dminsttcd",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dminsttNm']"
													},
													"sink": {
														"name": "dminsttnm",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rgstDt']"
													},
													"sink": {
														"name": "rgstdt",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['fnlSucsfDate']"
													},
													"sink": {
														"name": "fnlsucsfdate",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['fnlSucsfCorpOfcl']"
													},
													"sink": {
														"name": "fnlsucsfcorpofcl",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['linkInsttNm']"
													},
													"sink": {
														"name": "linkinsttnm",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['response']['body']['items']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_PPS_API_JSON",
											"type": "DatasetReference",
											"parameters": {
												"params": {
													"value": "@concat('/1230000/ScsbidInfoService01/',pipeline().parameters.service,'?type=json&inqryDiv=1&pageNo=',item(),'&numOfRows=',pipeline().parameters.one_page_row,'&inqryBgnDt=',variables('strdt'),'&inqryEndDt=',variables('enddt'),'&ServiceKey=',pipeline().parameters.Apikey)",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_POSTGRESQL_SNK",
											"type": "DatasetReference",
											"parameters": {
												"SinkSchema": {
													"value": "@pipeline().parameters.SinkSchema",
													"type": "Expression"
												},
												"SinkTable": {
													"value": "@pipeline().parameters.SinkTable",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"Apikey": {
						"type": "string",
						"defaultValue": "W26gwh49fADZe9fVLqkaAlzn5IPh6n9jf9FCHkThIs6UDblFv46xFoLaNzl011vFX8daAemoPlw4BubABfFBRg%3D%3D"
					},
					"service": {
						"type": "string",
						"defaultValue": "getScsbidListSttusThng01"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_mas_successful_bid_list_status_things"
					},
					"one_page_row": {
						"type": "string",
						"defaultValue": "999"
					},
					"pipstrdt": {
						"type": "string"
					},
					"pipenddt": {
						"type": "string"
					}
				},
				"variables": {
					"strdt": {
						"type": "String"
					},
					"enddt": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/조달청"
				},
				"annotations": [],
				"lastPublishTime": "2023-01-16T07:55:39Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_INDUSTRY_MND_DATE_BY_ML_SVC_M')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "국내 품목명세서_멀",
				"activities": [
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Lookup1_copy1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "SELECT unitnm , unitcd , tablename \nFROM cd_ods.tb_mnd_unit_master\n;",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 50,
							"activities": [
								{
									"name": "Execute Pipeline1",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"policy": {
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PIP_API_INDUSTRY_MND_DATE_BY_ML_SVC",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"pipunitcd": {
												"value": "@item().unitcd",
												"type": "Expression"
											},
											"pipunitnm": {
												"value": "@item().unitnm",
												"type": "Expression"
											},
											"piptablename": {
												"value": "@item().tablename",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "Lookup1_copy1",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "select cd_ods.func_mnd_date_by_ml_svc_temp();",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup1_copy1_copy1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach1",
								"dependencyConditions": [
									"Completed"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "select cd_ods.func_mnd_date_by_ml_svc_increase();",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							},
							"firstRowOnly": false
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"folder": {
					"name": "Industry/외부/국방부"
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_MS_MARKET_LINK_PG')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Set variable1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"additionalColumns": [
									{
										"name": "YYYYMM",
										"value": {
											"value": "@variables('YYYYMM')",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "AzurePostgreSQLSink",
								"writeBatchSize": 1000000,
								"writeBatchTimeout": "00:30:00",
								"preCopyScript": {
									"value": "DELETE \n  FROM cd_ods.tb_msdata_markect_link\n WHERE YYYYMM = '@{variables('YYYYMM')}'",
									"type": "Expression"
								},
								"writeMethod": "CopyCommand"
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "카테고리",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "category",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "월별",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "month",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "분기",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "qter",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "년도",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "year",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "채널",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "ch",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "지역",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "region",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "영업조직",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "salesorg",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ONOFF",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "onoff",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ITEM_DESC",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "item_desc",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "BARCODE",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "barcode",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "MANUFACTURER",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "manufacturer",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "BRAND",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "brand",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "SUB_BRAND",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "sub_brand",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ATTR01",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "attr01",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ATTR02",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "attr02",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ATTR03",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "attr03",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ATTR04",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "attr04",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ATTR05",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "attr05",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "판매금액",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "sales_amt",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "판매물량",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "sales_qtm",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "판매수량",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "sales_qty",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ND",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "nd",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "WD",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "wd",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "YYYYMM"
										},
										"sink": {
											"name": "yyyymm",
											"type": "String",
											"physicalType": "character varying"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_',variables('YYYYMM'),'.csv')",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": {
										"value": "@pipeline().parameters.SinkSchema",
										"type": "Expression"
									},
									"SinkTable": {
										"value": "@pipeline().parameters.SinkTable",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Set variable1",
						"type": "SetVariable",
						"dependsOn": [],
						"policy": {
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"variableName": "YYYYMM",
							"value": {
								"value": "@addToTime(addHours(utcNow(), 9),-1,'Month', 'yyyyMM')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "매출(주문)/외부/유통사MS정보"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "CD_ODS"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "tb_msdata_markect_link"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통사 MS 데이터_마켓링크"
					}
				},
				"variables": {
					"YYYYMM": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T09:12:20Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_copy1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Lookup API Info",
						"description": "API 정보를 가져오기 위해 LOOKUP 파일에test",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('  SELECT CMONTH2 FROM CD_ODS.APS_SDC_PW_MST WHERE CMONTH2 BETWEEN ''202210'' AND ''202211'' GROUP BY CMONTH2 ORDER BY CMONTH2;' )",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "CD_IF",
									"SourceTable": "APS_SDC_PW_MST"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup API Info",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup API Info').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "Copy data1_copy1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "DelimitedTextSource",
											"storeSettings": {
												"type": "AzureBlobFSReadSettings",
												"maxConcurrentConnections": 1,
												"recursive": true,
												"wildcardFolderPath": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',item().CMONTH2)",
													"type": "Expression"
												},
												"wildcardFileName": "*",
												"enablePartitionDiscovery": false
											},
											"formatSettings": {
												"type": "DelimitedTextReadSettings"
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings",
												"maxConcurrentConnections": 1,
												"copyBehavior": "MergeFiles"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": "@pipeline().parameters.AdlsDirectory",
												"FileName": "@pipeline().parameters.FileName"
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": "@pipeline().parameters.AdlsDirectory",
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName,'_', item().CMONTH2,'.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "도소매가격정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "도소매_conf"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보_원본"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "fabd919e-b1b9-4ef8-b9bc-c3e82b728bf2"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-11-17T03:07:25Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_copy4')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy data Previous Month",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "select *\n     from  cd_ods.dm_pr_sales_exp_day_summary_t\n",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"sink": {
								"type": "AzurePostgreSQLSink",
								"writeBatchSize": 1000000,
								"writeBatchTimeout": "00:30:00",
								"writeMethod": "CopyCommand"
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "CALMONTH",
											"type": "String"
										},
										"sink": {
											"name": "calmonth",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "CALDAY",
											"type": "String"
										},
										"sink": {
											"name": "calday",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "SITE",
											"type": "String"
										},
										"sink": {
											"name": "site",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "LGROUP",
											"type": "String"
										},
										"sink": {
											"name": "lgroup",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "LGROUP_NM",
											"type": "String"
										},
										"sink": {
											"name": "lgroup_nm",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ITEM_CODE",
											"type": "String"
										},
										"sink": {
											"name": "item_code",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ZBOX",
											"type": "Double"
										},
										"sink": {
											"name": "zbox",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZKG",
											"type": "Double"
										},
										"sink": {
											"name": "zkg",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZAMT",
											"type": "Double"
										},
										"sink": {
											"name": "zamt",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": {
										"value": "@pipeline().parameters.SourceSchema",
										"type": "Expression"
									},
									"SourceTable": {
										"value": "@pipeline().parameters.SourceTable",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": {
										"value": "cd_mart",
										"type": "Expression"
									},
									"SinkTable": {
										"value": "dm_pr_sales_exp_day_summary_t",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"SourceSchema": {
						"type": "string",
						"defaultValue": "CD_ODS"
					},
					"SourceTable": {
						"type": "string",
						"defaultValue": "BW_AZEP_O00000_FULL"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "bw_azep_o00000_full"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-11-30T23:54:34Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_ADR')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n행정처분결과 정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/행정처분결과 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRSDNT_NM']"
													},
													"sink": {
														"name": "PRSDNT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEL_NO']"
													},
													"sink": {
														"name": "TEL_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_INSTTCD_NM']"
													},
													"sink": {
														"name": "DSPS_INSTTCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAWORD_CD_NM']"
													},
													"sink": {
														"name": "LAWORD_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSDTLS_SEQ']"
													},
													"sink": {
														"name": "DSPSDTLS_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['VILTCN']"
													},
													"sink": {
														"name": "VILTCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PUBLIC_DT']"
													},
													"sink": {
														"name": "PUBLIC_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_CD_NM']"
													},
													"sink": {
														"name": "INDUTY_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_DCSNDT']"
													},
													"sink": {
														"name": "DSPS_DCSNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_BSSHNM']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_BGNDT']"
													},
													"sink": {
														"name": "DSPS_BGNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_TYPECD_NM']"
													},
													"sink": {
														"name": "DSPS_TYPECD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_ENDDT']"
													},
													"sink": {
														"name": "DSPS_ENDDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSCN']"
													},
													"sink": {
														"name": "DSPSCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0470']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0470']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "행정처분결과"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "행정처분결과Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/행정처분결과"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0470"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T08:49:47Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_ADR_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n행정처분결과 정보",
				"activities": [
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/행정처분결과 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I0470.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I0470.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRSDNT_NM']"
													},
													"sink": {
														"name": "PRSDNT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEL_NO']"
													},
													"sink": {
														"name": "TEL_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_INSTTCD_NM']"
													},
													"sink": {
														"name": "DSPS_INSTTCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAWORD_CD_NM']"
													},
													"sink": {
														"name": "LAWORD_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSDTLS_SEQ']"
													},
													"sink": {
														"name": "DSPSDTLS_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['VILTCN']"
													},
													"sink": {
														"name": "VILTCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PUBLIC_DT']"
													},
													"sink": {
														"name": "PUBLIC_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_CD_NM']"
													},
													"sink": {
														"name": "INDUTY_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_DCSNDT']"
													},
													"sink": {
														"name": "DSPS_DCSNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_BSSHNM']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_BGNDT']"
													},
													"sink": {
														"name": "DSPS_BGNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_TYPECD_NM']"
													},
													"sink": {
														"name": "DSPS_TYPECD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_ENDDT']"
													},
													"sink": {
														"name": "DSPS_ENDDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSCN']"
													},
													"sink": {
														"name": "DSPSCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0470']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0470']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I0470.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I0470.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "행정처분결과"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "행정처분결과Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/행정처분결과"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0470"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T11:46:34Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_ADR_D_V2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n행정처분결과 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/행정처분결과 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    0, \n    add(\n        div(\n            activity('API GET CNT').output.firstRow.I0470.total_count\n            ,1000\n        )\n        , 1\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRSDNT_NM']"
													},
													"sink": {
														"name": "PRSDNT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEL_NO']"
													},
													"sink": {
														"name": "TEL_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_INSTTCD_NM']"
													},
													"sink": {
														"name": "DSPS_INSTTCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAWORD_CD_NM']"
													},
													"sink": {
														"name": "LAWORD_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSDTLS_SEQ']"
													},
													"sink": {
														"name": "DSPSDTLS_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['VILTCN']"
													},
													"sink": {
														"name": "VILTCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PUBLIC_DT']"
													},
													"sink": {
														"name": "PUBLIC_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_CD_NM']"
													},
													"sink": {
														"name": "INDUTY_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_DCSNDT']"
													},
													"sink": {
														"name": "DSPS_DCSNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_BSSHNM']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_BGNDT']"
													},
													"sink": {
														"name": "DSPS_BGNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_TYPECD_NM']"
													},
													"sink": {
														"name": "DSPS_TYPECD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_ENDDT']"
													},
													"sink": {
														"name": "DSPS_ENDDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSCN']"
													},
													"sink": {
														"name": "DSPSCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0470']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0470']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(\n    add(\n        1\n        , mul(\n            item()\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(\n    if( \n        and(\n            lessOrEquals(\n                0\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I0470.total_count\n                )\n            )\n            , greaterOrEquals(\n                1000\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I0470.total_count\n                )\n            )\n        )\n        , activity('API GET CNT').output.firstRow.I0470.total_count        \n        , mul(\n            add(\n                item()\n                , 1\n            )\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "행정처분결과"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "행정처분결과Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/행정처분결과"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0470"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2023-02-03T05:16:03Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_BLPI')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n바코드연계제품정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/바코드연계제품정보 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['CLSBIZ_DT']"
													},
													"sink": {
														"name": "CLSBIZ_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['SITE_ADDR']"
													},
													"sink": {
														"name": "SITE_ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRMS_DT']"
													},
													"sink": {
														"name": "PRMS_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BAR_CD']"
													},
													"sink": {
														"name": "BAR_CD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['POG_DAYCNT']"
													},
													"sink": {
														"name": "POG_DAYCNT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_DCNM']"
													},
													"sink": {
														"name": "PRDLST_DCNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSH_NM']"
													},
													"sink": {
														"name": "BSSH_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['END_DT']"
													},
													"sink": {
														"name": "END_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_NM']"
													},
													"sink": {
														"name": "INDUTY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['C005']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['C005']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "바코드연계제품정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "바코드연계제품정보Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/바코드연계제품정보"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "C005"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_DITBCD')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n유통바코드",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/유통바코드 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통바코드"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "유통바코드Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/유통바코드"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2570"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_DITBCD_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n유통바코드",
				"activities": [
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/유통바코드 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I2570.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I2570.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx'), '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I2570.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I2570.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통바코드"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "유통바코드Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/유통바코드"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2570"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T12:48:09Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_DITBCD_D_V2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n유통바코드",
				"activities": [
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/유통바코드 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    0, \n    add(\n        div(\n            activity('API GET CNT').output.firstRow.I2570.total_count\n            ,1000\n        )\n        , 1\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx'), '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(\n    add(\n        1\n        , mul(\n            item()\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(\n    if( \n        and(\n            lessOrEquals(\n                0\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I2570.total_count\n                )\n            )\n            , greaterOrEquals(\n                1000\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I2570.total_count\n                )\n            )\n        )\n        , activity('API GET CNT').output.firstRow.I2570.total_count        \n        , mul(\n            add(\n                item()\n                , 1\n            )\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통바코드"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "유통바코드Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/유통바코드"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2570"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2023-02-03T05:16:03Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_FNFDB')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n식품영양성분DB",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/식품영양성분DB 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "식품영양성분DB"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "식품영양성분DBIndex"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/식품영양성분DB"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2790"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_TIK')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n검사부적합(국내) 정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/검사부적합(국내) 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['REGSTR_TELNO']"
													},
													"sink": {
														"name": "REGSTR_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['STDR_STND']"
													},
													"sink": {
														"name": "STDR_STND",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEST_ITMNM']"
													},
													"sink": {
														"name": "TEST_ITMNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INSTT_NM']"
													},
													"sink": {
														"name": "INSTT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TESTANALS_RSLT']"
													},
													"sink": {
														"name": "TESTANALS_RSLT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2620']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2620']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "검사부적합(국내)"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "검사부적합(국내)Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/검사부적합(국내)"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2620"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_TIK_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n검사부적합(국내) 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/검사부적합(국내) 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I2620.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I2620.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['REGSTR_TELNO']"
													},
													"sink": {
														"name": "REGSTR_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['STDR_STND']"
													},
													"sink": {
														"name": "STDR_STND",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEST_ITMNM']"
													},
													"sink": {
														"name": "TEST_ITMNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INSTT_NM']"
													},
													"sink": {
														"name": "INSTT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TESTANALS_RSLT']"
													},
													"sink": {
														"name": "TESTANALS_RSLT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2620']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2620']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I2620.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I2620.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "검사부적합(국내)"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "검사부적합(국내)Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/검사부적합(국내)"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2620"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T12:48:09Z"
			},
			"dependsOn": []
		}
	]
}