{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory 이름",
			"defaultValue": "CDI-Hub-ADF-p01"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_copy1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Lookup API Info",
						"description": "API 정보를 가져오기 위해 LOOKUP 파일에test",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('  SELECT CMONTH2 FROM CD_ODS.APS_SDC_PW_MST WHERE CMONTH2 BETWEEN ''202210'' AND ''202211'' GROUP BY CMONTH2 ORDER BY CMONTH2;' )",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "CD_IF",
									"SourceTable": "APS_SDC_PW_MST"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup API Info",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup API Info').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "Copy data1_copy1",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "DelimitedTextSource",
											"storeSettings": {
												"type": "AzureBlobFSReadSettings",
												"maxConcurrentConnections": 1,
												"recursive": true,
												"wildcardFolderPath": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',item().CMONTH2)",
													"type": "Expression"
												},
												"wildcardFileName": "*",
												"enablePartitionDiscovery": false
											},
											"formatSettings": {
												"type": "DelimitedTextReadSettings"
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings",
												"maxConcurrentConnections": 1,
												"copyBehavior": "MergeFiles"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": "@pipeline().parameters.AdlsDirectory",
												"FileName": "@pipeline().parameters.FileName"
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": "@pipeline().parameters.AdlsDirectory",
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName,'_', item().CMONTH2,'.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "도소매가격정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "도소매_conf"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보_원본"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "fabd919e-b1b9-4ef8-b9bc-c3e82b728bf2"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-11-17T03:07:25Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_copy2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Lookup API Info",
						"description": "API 정보를 가져오기 위해 LOOKUP 파일에test",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup API Info",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup API Info').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 5,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "RestSource",
											"additionalColumns": [
												{
													"name": "regday",
													"value": {
														"value": "@item().regday",
														"type": "Expression"
													}
												}
											],
											"httpRequestTimeout": "00:01:40",
											"requestInterval": "00.00:00:00.010",
											"requestMethod": "GET",
											"paginationRules": {
												"supportRFC5988": "true"
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['item_name']"
													},
													"sink": {
														"name": "item_name",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['item_code']"
													},
													"sink": {
														"name": "item_code",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['kind_name']"
													},
													"sink": {
														"name": "kind_name",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['kind_code']"
													},
													"sink": {
														"name": "kind_code",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rank']"
													},
													"sink": {
														"name": "rank",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['rank_code']"
													},
													"sink": {
														"name": "rank_code",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['unit']"
													},
													"sink": {
														"name": "unit",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day1']"
													},
													"sink": {
														"name": "day1",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr1']"
													},
													"sink": {
														"name": "dpr1",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day2']"
													},
													"sink": {
														"name": "day2",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr2']"
													},
													"sink": {
														"name": "dpr2",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day3']"
													},
													"sink": {
														"name": "day3",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr3']"
													},
													"sink": {
														"name": "dpr3",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day4']"
													},
													"sink": {
														"name": "day4",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr4']"
													},
													"sink": {
														"name": "dpr4",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day5']"
													},
													"sink": {
														"name": "day5",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr5']"
													},
													"sink": {
														"name": "dpr5",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day6']"
													},
													"sink": {
														"name": "day6",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr6']"
													},
													"sink": {
														"name": "dpr6",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['day7']"
													},
													"sink": {
														"name": "day7",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['dpr7']"
													},
													"sink": {
														"name": "dpr7",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['regday']"
													},
													"sink": {
														"name": "regday",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['data']['item']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_APSI_CPPI_KAMIS",
											"type": "DatasetReference",
											"parameters": {
												"cls_code": {
													"value": "@item().cls_code",
													"type": "Expression"
												},
												"category_code": {
													"value": "@item().category_code",
													"type": "Expression"
												},
												"regday": "@item().regday",
												"ApiKey": "@pipeline().parameters.Apikey"
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',substring( replace(item().regday,'-','') ,0,6)  )",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', item().category ,'_',item().cls , '_',replace(item().regday,'-',''),'_', '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "도소매가격정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "도소매_conf"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보_원본"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "fabd919e-b1b9-4ef8-b9bc-c3e82b728bf2"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-10-28T02:01:42Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_copy4')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy data Previous Month",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "select *\n     from  cd_ods.bw_azep_o00000_full\n     where calday between '20221001' and '20221130'",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"sink": {
								"type": "AzurePostgreSQLSink",
								"writeBatchSize": 1000000,
								"writeBatchTimeout": "00:30:00",
								"writeMethod": "CopyCommand"
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "COMP_CODE",
											"type": "String"
										},
										"sink": {
											"name": "comp_code",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "CALMONTH",
											"type": "String"
										},
										"sink": {
											"name": "calmonth",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "CALWEEK",
											"type": "String"
										},
										"sink": {
											"name": "calweek",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "CALDAY",
											"type": "String"
										},
										"sink": {
											"name": "calday",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "SALESORG",
											"type": "String"
										},
										"sink": {
											"name": "salesorg",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "DISTR_CHAN",
											"type": "String"
										},
										"sink": {
											"name": "distr_chan",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "MATERIAL",
											"type": "String"
										},
										"sink": {
											"name": "material",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "CUSTOMER",
											"type": "String"
										},
										"sink": {
											"name": "customer",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ZBOX",
											"type": "Decimal"
										},
										"sink": {
											"name": "zbox",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZEA",
											"type": "Decimal"
										},
										"sink": {
											"name": "zea",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZKG",
											"type": "Decimal"
										},
										"sink": {
											"name": "zkg",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "SALES_DIST",
											"type": "String"
										},
										"sink": {
											"name": "sales_dist",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "CUST_GROUP",
											"type": "String"
										},
										"sink": {
											"name": "cust_group",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "SALES_OFF",
											"type": "String"
										},
										"sink": {
											"name": "sales_off",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "SALES_GRP",
											"type": "String"
										},
										"sink": {
											"name": "sales_grp",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ZAMT",
											"type": "String"
										},
										"sink": {
											"name": "zamt",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZVAL_RET",
											"type": "Decimal"
										},
										"sink": {
											"name": "zval_ret",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZINVCDAMT",
											"type": "Double"
										},
										"sink": {
											"name": "zinvcdamt",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZGUWAVWR",
											"type": "Double"
										},
										"sink": {
											"name": "zguwavwr",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZHRVTT",
											"type": "Double"
										},
										"sink": {
											"name": "zhrvtt",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "COMP_CODE_KTL",
											"type": "String"
										},
										"sink": {
											"name": "comp_code_ktl",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ZGUKZWI2",
											"type": "Double"
										},
										"sink": {
											"name": "zgukzwi2",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZGUKZWI3",
											"type": "Double"
										},
										"sink": {
											"name": "zgukzwi3",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZGUKZWI4",
											"type": "Double"
										},
										"sink": {
											"name": "zgukzwi4",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZMKZWI4",
											"type": "Double"
										},
										"sink": {
											"name": "zmkzwi4",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZUMKZWI2",
											"type": "Double"
										},
										"sink": {
											"name": "zumkzwi2",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZUMKZWI3",
											"type": "Double"
										},
										"sink": {
											"name": "zumkzwi3",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "REG_DATE",
											"type": "DateTime"
										},
										"sink": {
											"name": "reg_date",
											"type": "DateTime",
											"physicalType": "timestamp without time zone"
										}
									},
									{
										"source": {
											"name": "ZBAEBU",
											"type": "String"
										},
										"sink": {
											"name": "zbaebu",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "ZSTPRS",
											"type": "Double"
										},
										"sink": {
											"name": "zstprs",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZHR_QTY",
											"type": "Double"
										},
										"sink": {
											"name": "zhr_qty",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZQTY_RET",
											"type": "Double"
										},
										"sink": {
											"name": "zqty_ret",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "BASE_UOM",
											"type": "String"
										},
										"sink": {
											"name": "base_uom",
											"type": "String",
											"physicalType": "character varying"
										}
									},
									{
										"source": {
											"name": "NT_WT_KG",
											"type": "Double"
										},
										"sink": {
											"name": "nt_wt_kg",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "INVCD_QTY",
											"type": "Double"
										},
										"sink": {
											"name": "invcd_qty",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "PRICE_STD",
											"type": "Double"
										},
										"sink": {
											"name": "price_std",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "INVCD_VAL",
											"type": "Double"
										},
										"sink": {
											"name": "invcd_val",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZRET_EA",
											"type": "Double"
										},
										"sink": {
											"name": "zret_ea",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZRET_KG",
											"type": "Double"
										},
										"sink": {
											"name": "zret_kg",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZRET_BOX",
											"type": "Double"
										},
										"sink": {
											"name": "zret_box",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZHR_EA",
											"type": "Double"
										},
										"sink": {
											"name": "zhr_ea",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZHR_KG",
											"type": "Double"
										},
										"sink": {
											"name": "zhr_kg",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZHR_BOX",
											"type": "Double"
										},
										"sink": {
											"name": "zhr_box",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZRETID_EA",
											"type": "Double"
										},
										"sink": {
											"name": "zretid_ea",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZRETID_KG",
											"type": "Double"
										},
										"sink": {
											"name": "zretid_kg",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZRETID_BOX",
											"type": "Double"
										},
										"sink": {
											"name": "zretid_box",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									},
									{
										"source": {
											"name": "ZHRLAT",
											"type": "Double"
										},
										"sink": {
											"name": "zhrlat",
											"type": "Decimal",
											"physicalType": "numeric"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": {
										"value": "@pipeline().parameters.SourceSchema",
										"type": "Expression"
									},
									"SourceTable": {
										"value": "@pipeline().parameters.SourceTable",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": {
										"value": "@pipeline().parameters.SinkSchema",
										"type": "Expression"
									},
									"SinkTable": {
										"value": "@pipeline().parameters.SinkTable",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "Execute_SP",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Copy data Previous Month",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": "select cd_mart.func_dm_pr_sales_summary('azure');",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"SourceSchema": {
						"type": "string",
						"defaultValue": "CD_ODS"
					},
					"SourceTable": {
						"type": "string",
						"defaultValue": "BW_AZEP_O00000_FULL"
					},
					"SinkSchema": {
						"type": "string",
						"defaultValue": "cd_ods"
					},
					"SinkTable": {
						"type": "string",
						"defaultValue": "bw_azep_o00000_full"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-11-30T23:54:34Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_KAMIS_copy5')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Lookup API Info",
						"description": "API 정보를 가져오기 위해 LOOKUP 파일에test",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": "select cd_mart.func_dm_pr_datadream_summary();",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							},
							"firstRowOnly": false
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "도소매가격정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "도소매_conf"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "Industry/외부/농수산식품/도소매가격정보_원본"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "fabd919e-b1b9-4ef8-b9bc-c3e82b728bf2"
					}
				},
				"variables": {
					"var": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Industry/외부/농수산식품"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-23T07:55:31Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_ADR')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n행정처분결과 정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/행정처분결과 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRSDNT_NM']"
													},
													"sink": {
														"name": "PRSDNT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEL_NO']"
													},
													"sink": {
														"name": "TEL_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_INSTTCD_NM']"
													},
													"sink": {
														"name": "DSPS_INSTTCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAWORD_CD_NM']"
													},
													"sink": {
														"name": "LAWORD_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSDTLS_SEQ']"
													},
													"sink": {
														"name": "DSPSDTLS_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['VILTCN']"
													},
													"sink": {
														"name": "VILTCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PUBLIC_DT']"
													},
													"sink": {
														"name": "PUBLIC_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_CD_NM']"
													},
													"sink": {
														"name": "INDUTY_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_DCSNDT']"
													},
													"sink": {
														"name": "DSPS_DCSNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_BSSHNM']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_BGNDT']"
													},
													"sink": {
														"name": "DSPS_BGNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_TYPECD_NM']"
													},
													"sink": {
														"name": "DSPS_TYPECD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_ENDDT']"
													},
													"sink": {
														"name": "DSPS_ENDDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSCN']"
													},
													"sink": {
														"name": "DSPSCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0470']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0470']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "행정처분결과"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "행정처분결과Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/행정처분결과"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0470"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T08:49:47Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_ADR_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n행정처분결과 정보",
				"activities": [
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/행정처분결과 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I0470.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I0470.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRSDNT_NM']"
													},
													"sink": {
														"name": "PRSDNT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEL_NO']"
													},
													"sink": {
														"name": "TEL_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_INSTTCD_NM']"
													},
													"sink": {
														"name": "DSPS_INSTTCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAWORD_CD_NM']"
													},
													"sink": {
														"name": "LAWORD_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSDTLS_SEQ']"
													},
													"sink": {
														"name": "DSPSDTLS_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['VILTCN']"
													},
													"sink": {
														"name": "VILTCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PUBLIC_DT']"
													},
													"sink": {
														"name": "PUBLIC_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_CD_NM']"
													},
													"sink": {
														"name": "INDUTY_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_DCSNDT']"
													},
													"sink": {
														"name": "DSPS_DCSNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_BSSHNM']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_BGNDT']"
													},
													"sink": {
														"name": "DSPS_BGNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_TYPECD_NM']"
													},
													"sink": {
														"name": "DSPS_TYPECD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_ENDDT']"
													},
													"sink": {
														"name": "DSPS_ENDDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSCN']"
													},
													"sink": {
														"name": "DSPSCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0470']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0470']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I0470.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I0470.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "행정처분결과"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "행정처분결과Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/행정처분결과"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0470"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T11:46:34Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_ADR_D_V2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n행정처분결과 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/행정처분결과 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    0, \n    add(\n        div(\n            activity('API GET CNT').output.firstRow.I0470.total_count\n            ,1000\n        )\n        , 1\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRSDNT_NM']"
													},
													"sink": {
														"name": "PRSDNT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEL_NO']"
													},
													"sink": {
														"name": "TEL_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_INSTTCD_NM']"
													},
													"sink": {
														"name": "DSPS_INSTTCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAWORD_CD_NM']"
													},
													"sink": {
														"name": "LAWORD_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSDTLS_SEQ']"
													},
													"sink": {
														"name": "DSPSDTLS_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['VILTCN']"
													},
													"sink": {
														"name": "VILTCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PUBLIC_DT']"
													},
													"sink": {
														"name": "PUBLIC_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_CD_NM']"
													},
													"sink": {
														"name": "INDUTY_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_DCSNDT']"
													},
													"sink": {
														"name": "DSPS_DCSNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_BSSHNM']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_BGNDT']"
													},
													"sink": {
														"name": "DSPS_BGNDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_TYPECD_NM']"
													},
													"sink": {
														"name": "DSPS_TYPECD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPS_ENDDT']"
													},
													"sink": {
														"name": "DSPS_ENDDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DSPSCN']"
													},
													"sink": {
														"name": "DSPSCN",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0470']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0470']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(\n    add(\n        1\n        , mul(\n            item()\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(\n    if( \n        and(\n            lessOrEquals(\n                0\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I0470.total_count\n                )\n            )\n            , greaterOrEquals(\n                1000\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I0470.total_count\n                )\n            )\n        )\n        , activity('API GET CNT').output.firstRow.I0470.total_count        \n        , mul(\n            add(\n                item()\n                , 1\n            )\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "행정처분결과"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "행정처분결과Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/행정처분결과"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0470"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2023-02-03T05:16:03Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_BLPI')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n바코드연계제품정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/바코드연계제품정보 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['CLSBIZ_DT']"
													},
													"sink": {
														"name": "CLSBIZ_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['SITE_ADDR']"
													},
													"sink": {
														"name": "SITE_ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRMS_DT']"
													},
													"sink": {
														"name": "PRMS_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BAR_CD']"
													},
													"sink": {
														"name": "BAR_CD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['POG_DAYCNT']"
													},
													"sink": {
														"name": "POG_DAYCNT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_DCNM']"
													},
													"sink": {
														"name": "PRDLST_DCNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSH_NM']"
													},
													"sink": {
														"name": "BSSH_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['END_DT']"
													},
													"sink": {
														"name": "END_DT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INDUTY_NM']"
													},
													"sink": {
														"name": "INDUTY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['C005']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['C005']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "바코드연계제품정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "바코드연계제품정보Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/바코드연계제품정보"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "C005"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_DITBCD')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n유통바코드",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/유통바코드 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통바코드"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "유통바코드Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/유통바코드"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2570"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_DITBCD_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n유통바코드",
				"activities": [
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/유통바코드 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I2570.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I2570.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx'), '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I2570.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I2570.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통바코드"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "유통바코드Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/유통바코드"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2570"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T12:48:09Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_DITBCD_D_V2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n유통바코드",
				"activities": [
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/유통바코드 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    0, \n    add(\n        div(\n            activity('API GET CNT').output.firstRow.I2570.total_count\n            ,1000\n        )\n        , 1\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx'), '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(\n    add(\n        1\n        , mul(\n            item()\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(\n    if( \n        and(\n            lessOrEquals(\n                0\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I2570.total_count\n                )\n            )\n            , greaterOrEquals(\n                1000\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I2570.total_count\n                )\n            )\n        )\n        , activity('API GET CNT').output.firstRow.I2570.total_count        \n        , mul(\n            add(\n                item()\n                , 1\n            )\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "유통바코드"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "유통바코드Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/유통바코드"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2570"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2023-02-03T05:16:03Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_FNFDB')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품안전나라)\n식품영양성분DB",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach Copy data",
						"description": "cdi-root 품질/외부/식품안전나라/식품영양성분DB 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy1",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 1,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HTRK_PRDLST_NM']"
													},
													"sink": {
														"name": "HTRK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LAST_UPDT_DTM']"
													},
													"sink": {
														"name": "LAST_UPDT_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['HRNK_PRDLST_NM']"
													},
													"sink": {
														"name": "HRNK_PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCD_NO']"
													},
													"sink": {
														"name": "BRCD_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_NM']"
													},
													"sink": {
														"name": "PRDLST_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDT_NM']"
													},
													"sink": {
														"name": "PRDT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CMPNY_NM']"
													},
													"sink": {
														"name": "CMPNY_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROW_ID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2570']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2570']['row']"
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품안전나라/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach Copy data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMM'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMM'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "식품영양성분DB"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "식품영양성분DBIndex"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품안전나라/식품영양성분DB"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2790"
					}
				},
				"folder": {
					"name": "품질/외부/식품안전나라"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_TIK')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n검사부적합(국내) 정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/검사부적합(국내) 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['REGSTR_TELNO']"
													},
													"sink": {
														"name": "REGSTR_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['STDR_STND']"
													},
													"sink": {
														"name": "STDR_STND",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEST_ITMNM']"
													},
													"sink": {
														"name": "TEST_ITMNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INSTT_NM']"
													},
													"sink": {
														"name": "INSTT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TESTANALS_RSLT']"
													},
													"sink": {
														"name": "TESTANALS_RSLT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2620']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2620']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "검사부적합(국내)"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "검사부적합(국내)Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/검사부적합(국내)"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2620"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_TIK_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n검사부적합(국내) 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/검사부적합(국내) 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I2620.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I2620.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['REGSTR_TELNO']"
													},
													"sink": {
														"name": "REGSTR_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['STDR_STND']"
													},
													"sink": {
														"name": "STDR_STND",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEST_ITMNM']"
													},
													"sink": {
														"name": "TEST_ITMNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INSTT_NM']"
													},
													"sink": {
														"name": "INSTT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TESTANALS_RSLT']"
													},
													"sink": {
														"name": "TESTANALS_RSLT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2620']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2620']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I2620.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I2620.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "검사부적합(국내)"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "검사부적합(국내)Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/검사부적합(국내)"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2620"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T12:48:09Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_TIK_D_SAMPLE')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n검사부적합(국내) 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/검사부적합(국내) 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I2620.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I2620.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['REGSTR_TELNO']"
													},
													"sink": {
														"name": "REGSTR_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['STDR_STND']"
													},
													"sink": {
														"name": "STDR_STND",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEST_ITMNM']"
													},
													"sink": {
														"name": "TEST_ITMNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INSTT_NM']"
													},
													"sink": {
														"name": "INSTT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TESTANALS_RSLT']"
													},
													"sink": {
														"name": "TESTANALS_RSLT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2620']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2620']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I2620.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I2620.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "검사부적합(국내)"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "검사부적합(국내)Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/검사부적합(국내)"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2620"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "_Sample/식품의약품안전처_SEQ"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-17T13:46:14Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_TIK_D_V2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n검사부적합(국내) 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/검사부적합(국내) 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    0, \n    add(\n        div(\n            activity('API GET CNT').output.firstRow.I2620.total_count\n            ,1000\n        )\n        , 1\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['REGSTR_TELNO']"
													},
													"sink": {
														"name": "REGSTR_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['STDR_STND']"
													},
													"sink": {
														"name": "STDR_STND",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TEST_ITMNM']"
													},
													"sink": {
														"name": "TEST_ITMNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['INSTT_NM']"
													},
													"sink": {
														"name": "INSTT_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['TESTANALS_RSLT']"
													},
													"sink": {
														"name": "TESTANALS_RSLT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "ROWID",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I2620']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I2620']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(\n    add(\n        0\n        , mul(\n            item()\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(\n    if( \n        and(\n            lessOrEquals(\n                0\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I2620.total_count\n                )\n            )\n            , greaterOrEquals(\n                1000\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I2620.total_count\n                )\n            )\n        )\n        , activity('API GET CNT').output.firstRow.I2620.total_count        \n        , mul(\n            add(\n                item()\n                , 1\n            )\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "검사부적합(국내)"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "검사부적합(국내)Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/검사부적합(국내)"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I2620"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2023-02-03T05:16:03Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_WSSI')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n회수.판매중지 정보",
				"activities": [
					{
						"name": "API REQ INFO",
						"description": "API INDEX 호출 정보를 가져오기 위해 설정 파일에서INDEX 번호를 읽어옵니다.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"dataset": {
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectoryConf",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.ConfFile,'.csv')",
										"type": "Expression"
									}
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/회수판매중지정보 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API REQ INFO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('API REQ INFO').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['RTRVLPLANDOC_RTRVLMTHD']"
													},
													"sink": {
														"name": "RTRVLPLANDOC_RTRVLMTHD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_CD']"
													},
													"sink": {
														"name": "PRDLST_CD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLPRVNS']"
													},
													"sink": {
														"name": "RTRVLPRVNS",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_TYPE']"
													},
													"sink": {
														"name": "PRDLST_TYPE",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['IMG_FILE_PATH']"
													},
													"sink": {
														"name": "IMG_FILE_PATH",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_CD_NM']"
													},
													"sink": {
														"name": "PRDLST_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_TELNO']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVL_GRDCD_NM']"
													},
													"sink": {
														"name": "RTRVL_GRDCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "RowId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0490']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0490']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@item().StartIdx",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@item().EndIdx",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(item().StartIdx , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "회수판매중지정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "회수판매중지정보Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/회수판매중지정보"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0490"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T13:34:54Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_WSSI_D')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n회수.판매중지 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/회수판매중지정보 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ORA GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    1\n    ,add(\n        div(\n            sub(\n                activity('API GET CNT').output.firstRow.I0490.total_count\n                ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n            )\n            , 1000\n        )\n        ,if(\n            greater(\n                mod(\n                    sub(\n                        activity('API GET CNT').output.firstRow.I0490.total_count\n                        ,int(activity('ORA GET CNT').output.firstRow.total_cnt)\n                    )\n                    , 1000\n                )\n                , 0\n            )\n            , 1\n            , 0\n        )\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['RTRVLPLANDOC_RTRVLMTHD']"
													},
													"sink": {
														"name": "RTRVLPLANDOC_RTRVLMTHD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_CD']"
													},
													"sink": {
														"name": "PRDLST_CD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLPRVNS']"
													},
													"sink": {
														"name": "RTRVLPRVNS",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_TYPE']"
													},
													"sink": {
														"name": "PRDLST_TYPE",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['IMG_FILE_PATH']"
													},
													"sink": {
														"name": "IMG_FILE_PATH",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_CD_NM']"
													},
													"sink": {
														"name": "PRDLST_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_TELNO']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVL_GRDCD_NM']"
													},
													"sink": {
														"name": "RTRVL_GRDCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "RowId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0490']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0490']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(sub(\n    add(\n        int(activity('ORA GET CNT').output.firstRow.total_cnt)\n        , add(mul(1000, item()), 1)\n    )\n, 1000))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(add(\n    int(variables('startIdx'))\n    , if(\n        greater(\n            sub(\n                activity('API GET CNT').output.firstRow.I0490.total_count\n                , int(variables('startIdx'))\n            )\n            , 1000\n        )\n        , 999\n        , sub(\n            activity('API GET CNT').output.firstRow.I0490.total_count\n            , int(variables('startIdx'))\n        )\n    )\n))",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Insert Sequence",
									"description": "cd_if.cd_fdsfty_seq 값 Insert",
									"type": "Script",
									"dependsOn": [
										{
											"activity": "API REQ_copy",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"linkedServiceName": {
										"referenceName": "LKS_ORA_P01",
										"type": "LinkedServiceReference"
									},
									"typeProperties": {
										"scripts": [
											{
												"type": "Query",
												"text": {
													"value": "INSERT INTO cd_if.cd_fdsfty_seq (type, row_id, qty, crt_dt, crt_user) \nVALUES (\n  '@{pipeline().parameters.ServiceId}'\n  , (SELECT NVL(MAX(row_id), 0) + 1 FROM cd_if.cd_fdsfty_seq WHERE type = '@{pipeline().parameters.ServiceId}')\n  , '@{variables('endIdx')}'\n  , to_char(sysdate, 'yyyymmddhhmiss')\n, 'system'\n);",
													"type": "Expression"
												}
											}
										],
										"scriptBlockExecutionTimeout": "02:00:00"
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "ORA GET CNT",
						"description": "저장된 값의 Total 값을 확인하기 위해 DB조",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "OracleSource",
								"oracleReaderQuery": {
									"value": "@concat('SELECT NVL(max(qty), 0) as total_cnt FROM cd_if.cd_fdsfty_seq WHERE type = ''', pipeline().parameters.ServiceId, ''' ORDER BY row_id DESC ')",
									"type": "Expression"
								},
								"partitionOption": "None",
								"convertDecimalToInteger": false,
								"queryTimeout": "02:00:00"
							},
							"dataset": {
								"referenceName": "DTS_ORACLE_SRC",
								"type": "DatasetReference",
								"parameters": {
									"SourceSchema": "1",
									"SourceTable": "1"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "회수판매중지정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "회수판매중지정보Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/회수판매중지정보"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0490"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2022-12-15T12:48:09Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_API_QUALITY_WSSI_D_V2')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "식품의약품안전처(식품위해정보)\n회수.판매중지 정보",
				"activities": [
					{
						"name": "ForEach API data",
						"description": "cdi-root / 품질/외부/식품위해관리/회수판매중지정보 위치에 항목별로 복사합니다.",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "API GET CNT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@range(\n    0, \n    add(\n        div(\n            activity('API GET CNT').output.firstRow.I0490.total_count\n            ,1000\n        )\n        , 1\n    )\n)",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "API REQ_copy",
									"description": "각 API 호출",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Set endIndex",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.12:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "XmlSource",
											"storeSettings": {
												"type": "HttpReadSettings",
												"requestMethod": "GET"
											},
											"formatSettings": {
												"type": "XmlReadSettings",
												"validationMode": "none",
												"namespaces": true
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"enableSkipIncompatibleRow": false,
										"translator": {
											"type": "TabularTranslator",
											"mappings": [
												{
													"source": {
														"path": "[['RTRVLPLANDOC_RTRVLMTHD']"
													},
													"sink": {
														"name": "RTRVLPLANDOC_RTRVLMTHD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_CD']"
													},
													"sink": {
														"name": "PRDLST_CD",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLPRVNS']"
													},
													"sink": {
														"name": "RTRVLPRVNS",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['FRMLCUNIT']"
													},
													"sink": {
														"name": "FRMLCUNIT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_REPORT_NO']"
													},
													"sink": {
														"name": "PRDLST_REPORT_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['CRET_DTM']"
													},
													"sink": {
														"name": "CRET_DTM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['LCNS_NO']"
													},
													"sink": {
														"name": "LCNS_NO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['DISTBTMLMT']"
													},
													"sink": {
														"name": "DISTBTMLMT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_TYPE']"
													},
													"sink": {
														"name": "PRDLST_TYPE",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['ADDR']"
													},
													"sink": {
														"name": "ADDR",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BRCDNO']"
													},
													"sink": {
														"name": "BRCDNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['IMG_FILE_PATH']"
													},
													"sink": {
														"name": "IMG_FILE_PATH",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['MNFDT']"
													},
													"sink": {
														"name": "MNFDT",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDTNM']"
													},
													"sink": {
														"name": "PRDTNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRDLST_CD_NM']"
													},
													"sink": {
														"name": "PRDLST_CD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['BSSHNM']"
													},
													"sink": {
														"name": "BSSHNM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['PRCSCITYPOINT_TELNO']"
													},
													"sink": {
														"name": "PRCSCITYPOINT_TELNO",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVLDSUSE_SEQ']"
													},
													"sink": {
														"name": "RTRVLDSUSE_SEQ",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['RTRVL_GRDCD_NM']"
													},
													"sink": {
														"name": "RTRVL_GRDCD_NM",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "[['@id']"
													},
													"sink": {
														"name": "RowId",
														"type": "String"
													}
												},
												{
													"source": {
														"path": "$['I0490']['total_count']"
													},
													"sink": {
														"name": "total_count",
														"type": "String"
													}
												}
											],
											"collectionReference": "$['I0490']['row']",
											"mapComplexValuesToString": false
										}
									},
									"inputs": [
										{
											"referenceName": "DTS_API_DITBCD_SRC",
											"type": "DatasetReference",
											"parameters": {
												"ApiKey": {
													"value": "@pipeline().parameters.Apikey",
													"type": "Expression"
												},
												"StartIdx": {
													"value": "@variables('startIdx')",
													"type": "Expression"
												},
												"EndIdx": {
													"value": "@variables('endIdx')",
													"type": "Expression"
												},
												"ServiceId": {
													"value": "@pipeline().parameters.ServiceId",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DTS_ADLS_SNK",
											"type": "DatasetReference",
											"parameters": {
												"AdlsDirectory": {
													"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(pipeline().parameters.FileName, '_', replace(variables('endIdx') , '/', '_'),'_',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'), '.csv')",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Set startIdx",
									"description": "시 인덱스 값을 정의한다.\n",
									"type": "SetVariable",
									"dependsOn": [],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "startIdx",
										"value": {
											"value": "@string(\n    add(\n        0\n        , mul(\n            item()\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Set endIndex",
									"description": "종료 인덱스 값을 정의한다.",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Set startIdx",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"variableName": "endIdx",
										"value": {
											"value": "@string(\n    if( \n        and(\n            lessOrEquals(\n                0\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I0490.total_count\n                )\n            )\n            , greaterOrEquals(\n                1000\n                , sub(\n                    mul(\n                        add(item(), 1)\n                        , 1000\n                    )\n                    , activity('API GET CNT').output.firstRow.I0490.total_count\n                )\n            )\n        )\n        , activity('API GET CNT').output.firstRow.I0490.total_count        \n        , mul(\n            add(\n                item()\n                , 1\n            )\n            , 1000\n        )\n    )\n)",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Merge Data",
						"description": "cdi-root /품질/외부/식품위해관리/ 위치에 항목별로 복사합니다.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ForEach API data",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"maxConcurrentConnections": 1,
									"recursive": true,
									"wildcardFolderPath": {
										"value": "@concat(pipeline().parameters.AdlsDirectoryOri,'/',formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'))",
										"type": "Expression"
									},
									"wildcardFileName": "*",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings",
									"maxConcurrentConnections": 1,
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"parallelCopies": 1,
							"enableSkipIncompatibleRow": true,
							"validateDataConsistency": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@pipeline().parameters.FileName",
										"type": "Expression"
									}
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DTS_ADLS_SNK",
								"type": "DatasetReference",
								"parameters": {
									"AdlsDirectory": {
										"value": "@pipeline().parameters.AdlsDirectory",
										"type": "Expression"
									},
									"FileName": {
										"value": "@concat(pipeline().parameters.FileName,'_', formatDateTime(addHours(utcNow(), 9), 'yyyyMMdd'),'.csv')\n\n",
										"type": "Expression"
									}
								}
							}
						]
					},
					{
						"name": "API GET CNT",
						"description": "API의 총 건 수를 확인하기 위해 API 1회 호출.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "XmlSource",
								"storeSettings": {
									"type": "HttpReadSettings",
									"requestMethod": "GET"
								},
								"formatSettings": {
									"type": "XmlReadSettings",
									"validationMode": "none",
									"detectDataType": true,
									"namespaces": true
								}
							},
							"dataset": {
								"referenceName": "DTS_API_DITBCD_SRC",
								"type": "DatasetReference",
								"parameters": {
									"ApiKey": "@pipeline().parameters.Apikey",
									"StartIdx": "1",
									"EndIdx": "1",
									"ServiceId": "@pipeline().parameters.ServiceId"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"AdlsDirectory": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "회수판매중지정보"
					},
					"AdlsDirectoryConf": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/conf"
					},
					"ConfFile": {
						"type": "string",
						"defaultValue": "회수판매중지정보Index"
					},
					"AdlsDirectoryOri": {
						"type": "string",
						"defaultValue": "품질/외부/식품위해관리/회수판매중지정보"
					},
					"Apikey": {
						"type": "string",
						"defaultValue": "f93320322b05463499de"
					},
					"ServiceId": {
						"type": "string",
						"defaultValue": "I0490"
					}
				},
				"variables": {
					"startIdx": {
						"type": "String"
					},
					"endIdx": {
						"type": "String"
					}
				},
				"folder": {
					"name": "품질/외부/식품위해관리"
				},
				"annotations": [],
				"lastPublishTime": "2023-02-03T05:16:03Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/PIP_DM_FM_ASSOCIATION_FREQUENCY_FULL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Execute_SP",
						"description": "소셜급식 연관어 빈도수/증감률 마트 호출",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzurePostgreSqlSource",
								"query": {
									"value": "select cd_mart.func_dm_fm_association_frequency();",
									"type": "Expression"
								},
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DTS_POSTGRESQL_SNK",
								"type": "DatasetReference",
								"parameters": {
									"SinkSchema": "1",
									"SinkTable": "1"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"folder": {
					"name": "데이터마트"
				},
				"annotations": [],
				"lastPublishTime": "2023-01-12T02:58:16Z"
			},
			"dependsOn": []
		}
	]
}