{
	"name": "PIP_API_INDUSTRY_AT_PRICE_SALE_SUB",
	"properties": {
		"description": "수요기관정보조회",
		"activities": [
			{
				"name": "pageNum",
				"description": "페이지 갯수",
				"type": "Lookup",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "JsonSource",
						"storeSettings": {
							"type": "HttpReadSettings",
							"requestMethod": "GET"
						},
						"formatSettings": {
							"type": "JsonReadSettings"
						}
					},
					"dataset": {
						"referenceName": "DTS_API_AT",
						"type": "DatasetReference",
						"parameters": {
							"params": {
								"value": "@concat('/openApi/price/sale.do?serviceKey=',pipeline().parameters.ApiKey,'&apiType=json&pageNo=1&saleDate=',pipeline().parameters.SaleDate,'&whsalCd=',pipeline().parameters.WhsalCd)",
								"type": "Expression"
							}
						}
					},
					"firstRowOnly": false
				}
			},
			{
				"name": "ForEach1",
				"type": "ForEach",
				"dependsOn": [
					{
						"activity": "pageNum",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"userProperties": [],
				"typeProperties": {
					"items": {
						"value": "@range(1  \n      ,add(\n             div(\n                  int(activity('pageNum').output.firstRow.totCnt) \n                  ,pipeline().parameters.one_page_row              \n                )\n            ,if(\n                greater(\n                        mod(\n                             int(activity('pageNum').output.firstRow.totCnt) \n                            ,pipeline().parameters.one_page_row\n                            )                               \n                       ,0\n                       )\n                ,1,0\n            )           \n       )\n)",
						"type": "Expression"
					},
					"isSequential": true
				}
			}
		],
		"parameters": {
			"ApiKey": {
				"type": "string",
				"defaultValue": "EDCC40BADEB8467BB2CD68B11A369A83"
			},
			"SinkSchema": {
				"type": "string",
				"defaultValue": "cd_ods"
			},
			"SinkTable": {
				"type": "string",
				"defaultValue": "tb_at_price_sale"
			},
			"SaleDate": {
				"type": "string",
				"defaultValue": "20231012"
			},
			"WhsalCd": {
				"type": "string",
				"defaultValue": "110001"
			},
			"one_page_row": {
				"type": "int",
				"defaultValue": 1000
			}
		},
		"variables": {
			"year": {
				"type": "String"
			},
			"accessToken": {
				"type": "String"
			},
			"dd": {
				"type": "String"
			}
		},
		"folder": {
			"name": "Industry/외부/도매시장"
		},
		"annotations": [],
		"lastPublishTime": "2023-01-16T07:55:39Z"
	},
	"type": "Microsoft.DataFactory/factories/pipelines"
}